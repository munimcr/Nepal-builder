<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoZayaan Tour Proposal Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --gozayaan-primary: #00026E;
            --gozayaan-dark: #000150;
            --gozayaan-light: #E8E8F5;
            --gozayaan-accent: #FF6B35;
            --text-dark: #1a1a1a;
            --text-gray: #555;
            --border-color: #e0e0e0;
            --bg-light: #fafafa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 450px 1fr 350px;
            gap: 20px;
        }

        .header {
            grid-column: 1 / -1;
            background: white;
            padding: 25px 35px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 2, 110, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--gozayaan-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: '‚úà';
            font-size: 32px;
        }

        .tagline {
            color: var(--text-gray);
            font-size: 13px;
            font-weight: 500;
        }

        .form-panel, .preview-panel, .format-panel {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            max-height: calc(100vh - 150px);
            overflow-y: auto;
        }

        .panel-title {
            font-family: 'Poppins', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--gozayaan-dark);
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--gozayaan-primary);
        }

        .form-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--gozayaan-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 3px;
            height: 16px;
            background: var(--gozayaan-primary);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 5px;
            font-size: 12px;
        }

        input, select, textarea {
            width: 100%;
            padding: 9px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gozayaan-primary);
            box-shadow: 0 0 0 3px rgba(0, 2, 110, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn {
            padding: 9px 18px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: var(--gozayaan-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--gozayaan-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 2, 110, 0.3);
        }

        .btn-secondary {
            background: var(--gozayaan-accent);
            color: white;
        }

        .btn-secondary:hover {
            background: #e55a2b;
        }

        .btn-outline {
            background: white;
            color: var(--gozayaan-primary);
            border: 2px solid var(--gozayaan-primary);
        }

        .btn-outline:hover {
            background: var(--gozayaan-light);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 11px;
        }

        .dynamic-list {
            margin-top: 8px;
        }

        .list-item {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
            align-items: center;
        }

        .list-item input {
            flex: 1;
        }

        .list-item button {
            padding: 7px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 10px;
            white-space: nowrap;
        }

        .hotel-row {
            background: var(--bg-light);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid var(--gozayaan-primary);
        }

        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .hotel-number {
            font-weight: 600;
            color: var(--gozayaan-primary);
            font-size: 13px;
        }

        .itinerary-day {
            background: var(--bg-light);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid var(--gozayaan-primary);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .day-number {
            font-weight: 600;
            color: var(--gozayaan-primary);
            font-size: 13px;
        }

        .ai-status {
            display: none;
            color: var(--gozayaan-primary);
            font-size: 11px;
            font-style: italic;
            margin-top: 5px;
            padding: 5px 10px;
            background: var(--gozayaan-light);
            border-radius: 5px;
        }

        .ai-status.active {
            display: block;
        }

        .help-text {
            font-size: 10px;
            color: var(--text-gray);
            font-style: italic;
            margin-top: 3px;
        }

        /* Format Panel */
        .format-section {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .format-section h4 {
            font-size: 13px;
            font-weight: 600;
            color: var(--gozayaan-dark);
            margin-bottom: 12px;
        }

        .color-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .color-input input[type="color"] {
            width: 50px;
            height: 35px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .color-input label {
            flex: 1;
            margin: 0;
        }

        .slider-group {
            margin-bottom: 12px;
        }

        .slider-group label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .slider-value {
            background: var(--gozayaan-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }

        .slider-group input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border: none;
            border-radius: 3px;
            padding: 0;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px;
            border: 2px solid var(--border-color);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            border-color: var(--gozayaan-primary);
            background: var(--gozayaan-light);
        }

        /* Compact PDF Preview Styles */
        #htmlPreview {
            font-family: 'Roboto', Arial, sans-serif;
            background: white;
            width: 210mm;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            font-size: 10px;
            line-height: 1.3;
        }

        .preview-header {
            background: #00026E;
            padding: 12px 30px;
            color: white;
        }

        .preview-logo {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .preview-website {
            font-size: 9px;
            opacity: 0.9;
        }

        .preview-title-section {
            text-align: center;
            padding: 15px 30px 10px;
            background: #f8f9fa;
        }

        .preview-tour-title {
            font-size: 20px;
            font-weight: 700;
            color: #00026E;
            margin-bottom: 5px;
        }

        .preview-tour-subtitle {
            font-size: 11px;
            color: #555;
            font-style: italic;
        }

        .preview-customer-info {
            padding: 12px 30px;
        }

        .preview-info-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
        }

        .preview-info-box h3 {
            font-size: 12px;
            color: #00026E;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .preview-info-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            margin-bottom: 4px;
            font-size: 10px;
        }

        .preview-info-label {
            font-weight: 600;
            color: #555;
        }

        .preview-info-value {
            color: #333;
        }

        .preview-description {
            padding: 10px 30px;
            background: #f8f9fa;
            margin: 0 30px 12px;
            border-radius: 6px;
        }

        .preview-description h3 {
            font-size: 12px;
            color: #00026E;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .preview-description p {
            font-size: 9px;
            color: #333;
            text-align: justify;
            line-height: 1.5;
        }

        .preview-details-bar {
            background: linear-gradient(135deg, #00026E 0%, #0003a0 100%);
            color: white;
            padding: 8px 30px;
            font-size: 9px;
            text-align: center;
            margin-bottom: 12px;
        }

        .preview-package-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 0 30px 12px;
        }

        .preview-package-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
        }

        .preview-package-box h3 {
            font-size: 11px;
            color: #00026E;
            margin-bottom: 8px;
            font-weight: 600;
            border-bottom: 1.5px solid #00026E;
            padding-bottom: 4px;
        }

        .preview-package-list {
            list-style: none;
        }

        .preview-package-list li {
            font-size: 8.5px;
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
            color: #333;
        }

        .preview-package-list li::before {
            position: absolute;
            left: 0;
            font-weight: bold;
            font-size: 9px;
        }

        .preview-includes li::before {
            content: '‚úì';
            color: #28a745;
        }

        .preview-excludes li::before {
            content: '‚úó';
            color: #dc3545;
        }

        .preview-hotel-section {
            padding: 0 30px 12px;
        }

        .preview-hotel-section h3 {
            font-size: 11px;
            color: #00026E;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .preview-hotel-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 8.5px;
            background: white;
        }

        .preview-hotel-table th,
        .preview-hotel-table td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: left;
        }

        .preview-hotel-table th {
            background: #00026E;
            color: white;
            font-weight: 600;
            font-size: 9px;
        }

        .preview-hotel-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .preview-itinerary-section {
            padding: 0 30px 12px;
        }

        .preview-itinerary-section h3 {
            font-size: 11px;
            color: #00026E;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .preview-itinerary-item {
            background: #f8f9fa;
            padding: 6px 10px;
            margin-bottom: 6px;
            border-left: 3px solid #00026E;
            border-radius: 3px;
            font-size: 8.5px;
        }

        .preview-day-label {
            font-weight: 700;
            color: #00026E;
            margin-bottom: 3px;
        }

        .preview-day-activities {
            color: #555;
        }

        .preview-price-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 12px 30px;
            background: #f8f9fa;
            margin: 0 30px 12px;
            border-radius: 6px;
        }

        .preview-price-box h3 {
            font-size: 11px;
            color: #00026E;
            margin-bottom: 8px;
            font-weight: 600;
            border-bottom: 1.5px solid #00026E;
            padding-bottom: 4px;
        }

        .preview-price-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            padding: 4px 0;
            font-size: 9px;
        }

        .preview-price-label {
            font-weight: 600;
            color: #555;
        }

        .preview-price-value {
            font-weight: 700;
            color: #333;
        }

        .preview-final-price {
            background: #00026E;
            color: white;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            text-align: center;
            font-size: 10px;
            font-weight: 700;
        }

        .preview-notes {
            padding: 10px 30px;
            font-size: 7.5px;
            color: #555;
            background: #fff9e6;
            margin: 0 30px 10px;
            border-radius: 6px;
            border-left: 3px solid #ffc107;
        }

        .preview-notes h4 {
            font-size: 9px;
            color: #00026E;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .preview-notes ul {
            margin-left: 15px;
        }

        .preview-notes li {
            margin-bottom: 2px;
            line-height: 1.4;
        }

        .preview-footer {
            background: #00026E;
            color: white;
            padding: 10px 30px;
            text-align: center;
            font-size: 9px;
        }

        .download-buttons {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 15px;
            border-top: 2px solid var(--border-color);
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px 50px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
        }

        .loading.active {
            display: block;
        }

        .loading-spinner {
            border: 4px solid var(--gozayaan-light);
            border-top: 4px solid var(--gozayaan-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }

        @media (max-width: 1600px) {
            .container {
                grid-template-columns: 400px 1fr;
            }
            .format-panel {
                grid-column: 1 / -1;
                max-height: none;
            }
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div>Generating PDF...</div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <div class="logo">GoZayaan</div>
                <div class="tagline">AI-Powered Tour Proposal Generator</div>
            </div>
        </div>

        <!-- FORM PANEL -->
        <div class="form-panel">
            <h2 class="panel-title">Tour Information</h2>
            
            <form id="proposalForm">
                <div class="form-section">
                    <div class="section-title">Destination</div>
                    
                    <div class="form-group">
                        <label>Country/Destination Name *</label>
                        <input type="text" id="countryName" required placeholder="e.g., Nepal, Maldives, Malaysia">
                        <div class="ai-status" id="aiStatus">ü§ñ Generating content...</div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Customer Details</div>
                    
                    <div class="form-group">
                        <label>Customer Name *</label>
                        <input type="text" id="customerName" required placeholder="Full name">
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="phoneNumber" required placeholder="1833184362">
                        </div>
                        <div class="form-group">
                            <label>Email Address *</label>
                            <input type="email" id="emailAddress" required placeholder="email@example.com">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Tour Dates</div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Journey Start Date *</label>
                            <input type="date" id="journeyDate" required>
                        </div>
                        <div class="form-group">
                            <label>Journey End Date *</label>
                            <input type="date" id="returnDate" required>
                        </div>
                    </div>
                    <p class="help-text">Format: Day/Month/Year (e.g., 12/February/2026)</p>
                </div>

                <div class="form-section">
                    <div class="section-title">Travelers</div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Number of Adults *</label>
                            <input type="number" id="adults" min="0" value="2" required>
                        </div>
                        <div class="form-group">
                            <label>Number of Children</label>
                            <input type="number" id="children" min="0" value="0">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Package Inclusions</div>
                    <div id="inclusionsList" class="dynamic-list"></div>
                    <button type="button" class="btn btn-outline btn-small" onclick="addInclusion()">+ Add Inclusion</button>
                </div>

                <div class="form-section">
                    <div class="section-title">Package Exclusions</div>
                    <div id="exclusionsList" class="dynamic-list"></div>
                    <button type="button" class="btn btn-outline btn-small" onclick="addExclusion()">+ Add Exclusion</button>
                </div>

                <div class="form-section">
                    <div class="section-title">Hotel Accommodation</div>
                    <div id="hotelContainer"></div>
                    <button type="button" class="btn btn-outline btn-small" onclick="addHotel()">+ Add Hotel</button>
                </div>

                <div class="form-section">
                    <div class="section-title">Daily Itinerary</div>
                    <div id="itineraryContainer"></div>
                    <button type="button" class="btn btn-outline btn-small" onclick="addItineraryDay()">+ Add Day</button>
                </div>

                <div class="form-section">
                    <div class="section-title">Pricing</div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Package Price (BDT) *</label>
                            <input type="number" id="packagePrice" required value="155250">
                        </div>
                        <div class="form-group">
                            <label>Discount (BDT)</label>
                            <input type="number" id="discount" value="20250">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Final Price Payable (BDT)</label>
                        <input type="number" id="finalPrice" readonly style="background: #f0f0f0; font-weight: 600;">
                    </div>

                    <div class="form-group">
                        <label>Contact Person</label>
                        <input type="text" id="contactPerson" value="Nafis - 01325087570">
                    </div>
                </div>
            </form>
        </div>

        <!-- PREVIEW PANEL -->
        <div class="preview-panel">
            <div id="htmlPreview"></div>
            
            <div class="download-buttons">
                <button class="btn btn-primary" onclick="downloadPDF()" style="width: 100%;">
                    üìÑ Download PDF
                </button>
            </div>
        </div>

        <!-- FORMAT CUSTOMIZATION PANEL -->
        <div class="format-panel">
            <h2 class="panel-title">PDF Formatting</h2>

            <div class="format-section">
                <h4>üé® Colors</h4>
                <div class="color-input">
                    <input type="color" id="primaryColor" value="#00026E">
                    <label>Primary Color</label>
                </div>
                <div class="color-input">
                    <input type="color" id="accentColor" value="#FF6B35">
                    <label>Accent Color</label>
                </div>
            </div>

            <div class="format-section">
                <h4>üìè Font Sizes</h4>
                <div class="slider-group">
                    <label>
                        <span>Title Size</span>
                        <span class="slider-value" id="titleSizeVal">20</span>
                    </label>
                    <input type="range" id="titleSize" min="16" max="24" value="20">
                </div>
                <div class="slider-group">
                    <label>
                        <span>Heading Size</span>
                        <span class="slider-value" id="headingSizeVal">11</span>
                    </label>
                    <input type="range" id="headingSize" min="9" max="14" value="11">
                </div>
                <div class="slider-group">
                    <label>
                        <span>Body Size</span>
                        <span class="slider-value" id="bodySizeVal">9</span>
                    </label>
                    <input type="range" id="bodySize" min="7" max="11" value="9">
                </div>
            </div>

            <div class="format-section">
                <h4>‚ö° Quick Presets</h4>
                <div class="preset-grid">
                    <button class="preset-btn" onclick="applyPreset('default')">üîµ Default</button>
                    <button class="preset-btn" onclick="applyPreset('compact')">üì¶ Compact</button>
                    <button class="preset-btn" onclick="applyPreset('spacious')">üåä Spacious</button>
                    <button class="preset-btn" onclick="applyPreset('bold')">üí™ Bold</button>
                </div>
            </div>

            <div class="format-section">
                <button class="btn btn-secondary" onclick="resetFormat()" style="width: 100%;">
                    üîÑ Reset to Default
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data
        let inclusions = [
            'Flight Tickets: DAC - KTM - DAC',
            'Accommodation in hotels',
            'Meal: Breakfast',
            'All transfers and tours as per itinerary'
        ];

        let exclusions = [
            'Visa Fee',
            'Personal expenses and tips',
            'Monument entrance fees',
            'Travel insurance'
        ];

        let hotels = [
            { location: 'Kathmandu', hotel: 'Hotel Surya Heritage', roomType: 'Deluxe', checkIn: '', checkOut: '' }
        ];

        let itineraryDays = [
            { day: 1, activities: 'Arrival, Transfer to Hotel, stay' },
            { day: 2, activities: 'Breakfast at hotel, sightseeing, stay' }
        ];

        let tagline = '';
        let description = '';

        let pdfFormat = {
            primaryColor: '#00026E',
            accentColor: '#FF6B35',
            titleSize: 20,
            headingSize: 11,
            bodySize: 9
        };

        // Format date as Day/Month/Year
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = date.getDate();
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Calculate days and nights
        function calculateDuration() {
            const start = new Date(document.getElementById('journeyDate').value);
            const end = new Date(document.getElementById('returnDate').value);
            
            if (start && end && end > start) {
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const nights = diffDays;
                const days = diffDays + 1;
                return { days, nights };
            }
            return { days: 0, nights: 0 };
        }

        // Calculate nights between dates
        function calculateNights(checkIn, checkOut) {
            if (!checkIn || !checkOut) return 0;
            const start = new Date(checkIn);
            const end = new Date(checkOut);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Generate tour name
        function generateTourName() {
            const country = document.getElementById('countryName').value;
            const duration = calculateDuration();
            if (country && duration.days > 0) {
                return `${country} Tour Package ${duration.days} Days & ${duration.nights} Nights`;
            }
            return country ? `${country} Tour Package` : 'Tour Package';
        }

        // AI Content Generation
        async function generateAIContent(country) {
            if (!country) return;

            const aiStatus = document.getElementById('aiStatus');
            aiStatus.classList.add('active');

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `Generate a tour package tagline and description for ${country}. 

Format as JSON:
{
  "tagline": "A captivating one-line tagline (max 12 words)",
  "description": "A compelling 4-5 sentence description"
}

Only return valid JSON.`
                        }]
                    })
                });

                const data = await response.json();
                const content = data.content[0].text;
                
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const result = JSON.parse(jsonMatch[0]);
                    tagline = result.tagline;
                    description = result.description;
                }

            } catch (error) {
                console.error('AI error:', error);
                tagline = `Embark on an Unforgettable Journey to ${country}`;
                description = `Discover the magic of ${country}! Experience stunning landscapes, rich cultural heritage, and unforgettable adventures.`;
            }

            aiStatus.classList.remove('active');
            updatePreview();
        }

        let countryTimeout;
        document.getElementById('countryName')?.addEventListener('input', function() {
            clearTimeout(countryTimeout);
            countryTimeout = setTimeout(() => {
                const country = this.value.trim();
                if (country.length > 2) {
                    generateAIContent(country);
                }
            }, 1000);
        });

        // Inclusions
        function renderInclusions() {
            const container = document.getElementById('inclusionsList');
            container.innerHTML = '';
            
            inclusions.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <input type="text" value="${item}" onchange="updateInclusion(${index}, this.value)">
                    <button type="button" onclick="removeInclusion(${index})">Remove</button>
                `;
                container.appendChild(div);
            });
            updatePreview();
        }

        function addInclusion() {
            inclusions.push('');
            renderInclusions();
        }

        function removeInclusion(index) {
            inclusions.splice(index, 1);
            renderInclusions();
        }

        function updateInclusion(index, value) {
            inclusions[index] = value;
            updatePreview();
        }

        // Exclusions
        function renderExclusions() {
            const container = document.getElementById('exclusionsList');
            container.innerHTML = '';
            
            exclusions.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <input type="text" value="${item}" onchange="updateExclusion(${index}, this.value)">
                    <button type="button" onclick="removeExclusion(${index})">Remove</button>
                `;
                container.appendChild(div);
            });
            updatePreview();
        }

        function addExclusion() {
            exclusions.push('');
            renderExclusions();
        }

        function removeExclusion(index) {
            exclusions.splice(index, 1);
            renderExclusions();
        }

        function updateExclusion(index, value) {
            exclusions[index] = value;
            updatePreview();
        }

        // Hotels
        function renderHotels() {
            const container = document.getElementById('hotelContainer');
            container.innerHTML = '';
            
            hotels.forEach((hotel, index) => {
                const hotelDiv = document.createElement('div');
                hotelDiv.className = 'hotel-row';
                hotelDiv.innerHTML = `
                    <div class="hotel-header">
                        <span class="hotel-number">Hotel ${index + 1}</span>
                        <button type="button" class="btn btn-secondary btn-small" onclick="removeHotel(${index})">Remove</button>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" value="${hotel.location}" onchange="updateHotel(${index}, 'location', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Hotel Name</label>
                        <input type="text" value="${hotel.hotel}" onchange="updateHotel(${index}, 'hotel', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Room Type</label>
                        <input type="text" value="${hotel.roomType}" onchange="updateHotel(${index}, 'roomType', this.value)">
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label>Check-in Date</label>
                            <input type="date" value="${hotel.checkIn}" onchange="updateHotel(${index}, 'checkIn', this.value)">
                        </div>
                        <div class="form-group">
                            <label>Check-out Date</label>
                            <input type="date" value="${hotel.checkOut}" onchange="updateHotel(${index}, 'checkOut', this.value)">
                        </div>
                    </div>
                    <p class="help-text">Nights: ${calculateNights(hotel.checkIn, hotel.checkOut)}</p>
                `;
                container.appendChild(hotelDiv);
            });
            updatePreview();
        }

        function addHotel() {
            hotels.push({
                location: '',
                hotel: '',
                roomType: 'Deluxe',
                checkIn: '',
                checkOut: ''
            });
            renderHotels();
        }

        function removeHotel(index) {
            if (hotels.length > 1) {
                hotels.splice(index, 1);
                renderHotels();
            }
        }

        function updateHotel(index, field, value) {
            hotels[index][field] = value;
            renderHotels();
        }

        // Itinerary
        function renderItinerary() {
            const container = document.getElementById('itineraryContainer');
            container.innerHTML = '';
            
            itineraryDays.forEach((day, index) => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'itinerary-day';
                dayDiv.innerHTML = `
                    <div class="day-header">
                        <span class="day-number">Day ${day.day}</span>
                        <button type="button" class="btn btn-secondary btn-small" onclick="removeDay(${index})">Remove</button>
                    </div>
                    <div class="form-group">
                        <label>Activities</label>
                        <textarea rows="2" onchange="updateDay(${index}, this.value)">${day.activities}</textarea>
                    </div>
                `;
                container.appendChild(dayDiv);
            });
            updatePreview();
        }

        function addItineraryDay() {
            itineraryDays.push({
                day: itineraryDays.length + 1,
                activities: ''
            });
            renderItinerary();
        }

        function removeDay(index) {
            if (itineraryDays.length > 1) {
                itineraryDays.splice(index, 1);
                itineraryDays.forEach((day, i) => {
                    day.day = i + 1;
                });
                renderItinerary();
            }
        }

        function updateDay(index, value) {
            itineraryDays[index].activities = value;
            updatePreview();
        }

        // Price
        function calculateFinalPrice() {
            const packagePrice = parseFloat(document.getElementById('packagePrice').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const finalPrice = packagePrice - discount;
            document.getElementById('finalPrice').value = finalPrice;
            return finalPrice;
        }

        // Format
        function updateFormatSettings() {
            pdfFormat.primaryColor = document.getElementById('primaryColor').value;
            pdfFormat.accentColor = document.getElementById('accentColor').value;
            pdfFormat.titleSize = parseInt(document.getElementById('titleSize').value);
            pdfFormat.headingSize = parseInt(document.getElementById('headingSize').value);
            pdfFormat.bodySize = parseInt(document.getElementById('bodySize').value);
            
            updateSliderValues();
            applyFormatToPreview();
        }

        function updateSliderValues() {
            document.getElementById('titleSizeVal').textContent = pdfFormat.titleSize;
            document.getElementById('headingSizeVal').textContent = pdfFormat.headingSize;
            document.getElementById('bodySizeVal').textContent = pdfFormat.bodySize;
        }

        function applyFormatToPreview() {
            const preview = document.getElementById('htmlPreview');
            
            preview.querySelectorAll('.preview-header, .preview-details-bar, .preview-final-price, .preview-footer, .preview-hotel-table th').forEach(el => {
                el.style.background = pdfFormat.primaryColor;
            });
            
            preview.querySelectorAll('.preview-tour-title, .preview-info-box h3, .preview-description h3, .preview-package-box h3, .preview-hotel-section h3, .preview-itinerary-section h3, .preview-price-box h3, .preview-day-label, .preview-notes h4').forEach(el => {
                el.style.color = pdfFormat.primaryColor;
            });
            
            const titleEl = preview.querySelector('.preview-tour-title');
            if (titleEl) titleEl.style.fontSize = pdfFormat.titleSize + 'px';
            
            preview.querySelectorAll('.preview-info-box h3, .preview-description h3, .preview-package-box h3, .preview-hotel-section h3, .preview-itinerary-section h3, .preview-price-box h3').forEach(el => {
                el.style.fontSize = pdfFormat.headingSize + 'px';
            });
            
            preview.querySelectorAll('.preview-description p, .preview-package-list li, .preview-itinerary-item, .preview-price-row, .preview-hotel-table').forEach(el => {
                el.style.fontSize = pdfFormat.bodySize + 'px';
            });
        }

        function applyPreset(preset) {
            const presets = {
                default: { primaryColor: '#00026E', accentColor: '#FF6B35', titleSize: 20, headingSize: 11, bodySize: 9 },
                compact: { primaryColor: '#00026E', accentColor: '#FF6B35', titleSize: 18, headingSize: 10, bodySize: 8 },
                spacious: { primaryColor: '#00026E', accentColor: '#FF6B35', titleSize: 22, headingSize: 12, bodySize: 10 },
                bold: { primaryColor: '#D32F2F', accentColor: '#FFA000', titleSize: 22, headingSize: 12, bodySize: 10 }
            };

            pdfFormat = {...presets[preset]};
            
            document.getElementById('primaryColor').value = pdfFormat.primaryColor;
            document.getElementById('accentColor').value = pdfFormat.accentColor;
            document.getElementById('titleSize').value = pdfFormat.titleSize;
            document.getElementById('headingSize').value = pdfFormat.headingSize;
            document.getElementById('bodySize').value = pdfFormat.bodySize;
            
            updateFormatSettings();
        }

        function resetFormat() {
            applyPreset('default');
        }

        // Update Preview
        function updatePreview() {
            const country = document.getElementById('countryName').value || 'Destination';
            const tourName = generateTourName();
            const customerName = document.getElementById('customerName').value || 'Customer Name';
            const phoneNumber = document.getElementById('phoneNumber').value || '';
            const emailAddress = document.getElementById('emailAddress').value || '';
            const journeyDate = document.getElementById('journeyDate').value;
            const returnDate = document.getElementById('returnDate').value;
            const adults = document.getElementById('adults').value || 0;
            const children = document.getElementById('children').value || 0;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const finalPrice = calculateFinalPrice();
            const contactPerson = document.getElementById('contactPerson').value || '';

            const totalTravelers = `Adult X ${adults}, Child X ${children}`;

            // Hotel Table HTML
            let hotelTableHTML = '';
            hotels.forEach(hotel => {
                if (hotel.hotel) {
                    const nights = calculateNights(hotel.checkIn, hotel.checkOut);
                    hotelTableHTML += `
                        <tr>
                            <td>${formatDate(hotel.checkIn)}</td>
                            <td>${hotel.location}</td>
                            <td>${hotel.hotel}</td>
                            <td>${hotel.roomType}</td>
                            <td>${nights}</td>
                        </tr>
                    `;
                }
            });

            let previewHTML = `
                <div class="preview-header">
                    <div class="preview-logo">gozayaan</div>
                    <div class="preview-website">www.gozayaan.com</div>
                </div>

                <div class="preview-title-section">
                    <h1 class="preview-tour-title">${country} Tour Package</h1>
                    <p class="preview-tour-subtitle">${tagline || 'Embark on an Unforgettable Journey'}</p>
                </div>

                <div class="preview-customer-info">
                    <div class="preview-info-box">
                        <h3>Proposal prepared for</h3>
                        <div class="preview-info-row">
                            <span class="preview-info-label">Name</span>
                            <span class="preview-info-value">${customerName}</span>
                        </div>
                        <div class="preview-info-row">
                            <span class="preview-info-label">Phone</span>
                            <span class="preview-info-value">${phoneNumber}</span>
                        </div>
                        <div class="preview-info-row">
                            <span class="preview-info-label">Email</span>
                            <span class="preview-info-value">${emailAddress}</span>
                        </div>
                        <div class="preview-info-row">
                            <span class="preview-info-label">Tour Name</span>
                            <span class="preview-info-value">${tourName}</span>
                        </div>
                        <div class="preview-info-row">
                            <span class="preview-info-label">Travelers</span>
                            <span class="preview-info-value">${totalTravelers}</span>
                        </div>
                    </div>
                </div>

                <div class="preview-description">
                    <h3>Discover ${country}!</h3>
                    <p>${description || `Experience the beauty and culture of ${country}.`}</p>
                </div>

                <div class="preview-details-bar">
                    ${tourName} | Journey: ${formatDate(journeyDate)} | Return: ${formatDate(returnDate)}
                </div>

                <div class="preview-package-sections">
                    <div class="preview-package-box">
                        <h3>Package Includes</h3>
                        <ul class="preview-package-list preview-includes">
                            ${inclusions.filter(i => i).map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="preview-package-box">
                        <h3>Package Excludes</h3>
                        <ul class="preview-package-list preview-excludes">
                            ${exclusions.filter(i => i).map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <div class="preview-hotel-section">
                    <h3>Proposed Accommodation</h3>
                    <table class="preview-hotel-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Hotel</th>
                                <th>Room</th>
                                <th>Night(s)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${hotelTableHTML}
                        </tbody>
                    </table>
                </div>

                <div class="preview-itinerary-section">
                    <h3>Proposed Itinerary</h3>
                    ${itineraryDays.map(day => `
                        <div class="preview-itinerary-item">
                            <div class="preview-day-label">Day ${day.day}</div>
                            <div class="preview-day-activities">${day.activities}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="preview-price-section">
                    <div class="preview-price-box">
                        <h3>Package Price</h3>
                        <div class="preview-price-row">
                            <span class="preview-price-label">Package Price</span>
                            <span class="preview-price-value">BDT ${packagePrice.toLocaleString()}</span>
                        </div>
                        <div class="preview-price-row">
                            <span class="preview-price-label">Discount</span>
                            <span class="preview-price-value">BDT ${discount.toLocaleString()}</span>
                        </div>
                        <div class="preview-final-price">
                            Final: BDT ${finalPrice.toLocaleString()} (${parseInt(adults) + parseInt(children)} Travelers)
                        </div>
                    </div>
                    <div class="preview-price-box">
                        <h3>Contact Info</h3>
                        <div class="preview-price-row">
                            <span class="preview-price-label">Contact:</span>
                            <span class="preview-price-value">${contactPerson}</span>
                        </div>
                        <div style="margin-top: 10px; font-size: 8.5px; color: #555;">
                            <strong>Email:</strong> tours@gozayaan.com
                        </div>
                    </div>
                </div>

                <div class="preview-notes">
                    <h4>Note:</h4>
                    <ul>
                        <li>Package prices subject to change per government regulations and availability.</li>
                        <li>Rooms subject to availability. Booking confirmed upon reservation.</li>
                        <li>Airfares subject to availability and vary by date/time of booking.</li>
                    </ul>
                </div>

                <div class="preview-footer">
                    Download GoZayaan App - Google Play & App Store
                </div>
            `;

            document.getElementById('htmlPreview').innerHTML = previewHTML;
            applyFormatToPreview();
        }

        // Download PDF
        async function downloadPDF() {
            const overlay = document.getElementById('overlay');
            const loading = document.getElementById('loading');
            
            overlay.classList.add('active');
            loading.classList.add('active');

            try {
                const element = document.getElementById('htmlPreview');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

                const country = document.getElementById('countryName').value || 'Tour';
                const customerName = document.getElementById('customerName').value || 'Customer';
                const fileName = `${country} Tour Proposal for ${customerName}.pdf`;
                
                pdf.save(fileName);

            } catch (error) {
                console.error('PDF error:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                overlay.classList.remove('active');
                loading.classList.remove('active');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderInclusions();
            renderExclusions();
            renderHotels();
            renderItinerary();
            
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });

            document.getElementById('packagePrice').addEventListener('input', calculateFinalPrice);
            document.getElementById('discount').addEventListener('input', calculateFinalPrice);

            document.getElementById('primaryColor').addEventListener('change', updateFormatSettings);
            document.getElementById('accentColor').addEventListener('change', updateFormatSettings);
            document.getElementById('titleSize').addEventListener('input', updateFormatSettings);
            document.getElementById('headingSize').addEventListener('input', updateFormatSettings);
            document.getElementById('bodySize').addEventListener('input', updateFormatSettings);

            updatePreview();
        });
    </script>
</body>
</html>